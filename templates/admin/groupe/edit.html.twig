{% extends 'base_admin.html.twig' %}

{% block title %}Groupe{% endblock %}
{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('assets/css/select2.min.css') }}" type="text/css"/>
{% endblock %}
{% block body %}
<div class="col-md-12">
		<div class="card ">
			<div class="card-header card-header-green card-header-text">
				<div class="card-text">
					<h4 class="card-title">Modifier groupe</h4>
				</div>
			</div>
			<div class="card-body ">
				{{ form_start(form, {'action': path('app_admin_groupe_edit', { 'id': groupe.id }), 'method': 'POST', 'attr': {'enctype':'multipart/form-data', 'class': 'form-horizontal'}}) }}
                <div class="row">
                <label class="col-sm-2 col-form-label">Ann√©e</label>
					<div class="col-sm-10">
						<div class="form_group">
							{{ form_widget(form.Annee) }}
						</div>
					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Nom</label>
					<div class="col-sm-10">
						<div class="form_group">
							{{ form_widget(form.Nom) }}
						</div>
					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Zone</label>
					<div class="col-sm-10">
						<div class="form_group">
							{{ form_widget(form.zone) }}
						</div>
					</div>
				</div>
				<div class="row  mt-3">
					<label class="col-sm-2 col-form-label">Provinces</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.Provinces) }}
						</div>
					</div>
				</div>
				<div class="row  mt-3">
					<label class="col-sm-2 col-form-label">Districts</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.districts) }}
						</div>
					</div>
				</div>
			</div>
			<div class="card-footer ">
				{{ form_widget(form.save) }}
			</div>
			{{ form_end(form) }}
		</div>
	</div>
{% endblock %}
{% block javascripts %}
	<script src="{{asset('assets/js/select2.min.js')}}"></script>
	<script>
		$(document).ready(function () {
	
				$(".mul-select").select2({
				placeholder: "Choisir province", // placeholder
				tags: true,
				tokenSeparators: ['/', ',', ';', " "]
				});

				$(".mul-select-district").select2({
				placeholder: "Choisir district", // placeholder
				tags: true,
				tokenSeparators: ['/', ',', ';', " "]
				});
						//$("#groupe_districts").empty();
				getDistricts();
				
		});

		function inArray(needle, haystack) {
			var length = haystack.length;
			for(var i = 0; i < length; i++) {
				if(haystack[i] == needle) return true;
			}
			return false;
		}


		function getDistricts() {
			let provinceIds = $('#groupe_Provinces').val();
			let zone = $('#groupe_zone').val();
			if (provinceIds.length > 0) {
					$("#loader").show();
					$.ajax({
					url: '/admin/groupe/districts',
					type: 'post',
					data: {
					provinceIds: provinceIds,
					zone: zone
					},
					success: function (response) { // Replace current position field ...
						$("#groupe_districts").empty();

						var lastKey = Object.keys(response)[Object.keys(response).length - 1];

						$("#groupe_districts").append('<option value="">Choisir district</option>');

						$.each(response, function (key, commune) {
							 let districts = {{ districtsGroupe|json_encode|raw }}; //tableau
							 if (inArray(commune['id'], districts)) {
								$("#groupe_districts").append('<option selected = "selected" value="' + commune['id'] + '">' + commune['Nom'] + '</option>').trigger('change');
							 } else {
								$("#groupe_districts").append('<option value="' + commune['id'] + '">' + commune['Nom'] + '</option>').trigger('change');
							 }
						});
						$("#loader").hide();
						// Position field now displays the appropriate positions.
					}
					});
				} else {
					$("#groupe_districts").empty();
				}
			}

	</script>
{% endblock %}

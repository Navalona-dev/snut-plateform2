{% extends 'base_admin.html.twig' %}

{% block title %}Edit
{% endblock %}
{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('assets/css/select2.min.css') }}" type="text/css"/>
{% endblock %}
{% block body %}
	<div class="col-md-12">
		<div class="card ">
			<div class="card-header card-header-green card-header-text">
				<div class="card-text">
					<h4 class="card-title">Modifier utilisateur</h4>
				</div>
			</div>
			<div class="card-body ">
				{{ form_start(form, {'action': path('admin_user_edit', { 'user': id }), 'method': 'POST', 'attr': {'enctype':'multipart/form-data', 'class': 'form-horizontal'}}) }}
				<div class="row">
					<label class="col-sm-2 col-form-label">Activation</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.isActive) }}
						</div>

					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Niveau</label>
					<div class="col-sm-10">
						<div class="form_group">
							{{ form_widget(form.niveau) }}
						</div>
					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Region</label>
					<div class="col-sm-10">
						<div class="form_group">
							{{ form_widget(form.id_region) }}
						</div>
					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Commune</label>
					<div class="col-sm-10">
						<div class="form_group">
							{{ form_widget(form.id_commune) }}
						</div>
					</div>
				</div>
				<div class="row  mt-3">
					<label class="col-sm-2 col-form-label">Privilèges</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.privileges) }}
						</div>
					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Niveau hierarchique</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.niveauHierarchique) }}
						</div>
					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Nom</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.nom) }}
						</div>
					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Prénoms</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.prenom) }}
						</div>

					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Téléphone</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.telephone) }}
						</div>

					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Identifiant</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.username) }}
						</div>

					</div>
				</div>
				<div class="row">
					<label class="col-sm-2 col-form-label">Email</label>
					<div class="col-sm-10">
						<div class="form-group">
							{{ form_widget(form.email) }}
						</div>

					</div>
				</div>
			</div>
			<div class="card-footer ">
				{{ form_widget(form.save) }}
			</div>
			{{ form_end(form) }}
		</div>
	</div>
{% endblock %}
{% block javascripts %}
	<script src="{{asset('assets/js/select2.min.js')}}"></script>
	<script>
		$(document).ready(function () {
if (($('#user_id_region').val() != undefined) && ($('#user_id_region').val() != "")) {
$('#user_id_region').parent().parent().parent().css('display', 'flex');
$('#user_id_commune').parent().parent().parent().css('display', 'flex');
} else {
$('#user_id_region').parent().parent().parent().css('display', 'none');
$('#user_id_commune').parent().parent().parent().css('display', 'none');
}


$(".mul-select").select2({
placeholder: "Choisir privilege", // placeholder
tags: true,
tokenSeparators: ['/', ',', ';', " "]
});

$('#user_imageFile_file').on('change', function (e) { // get the file name

let filename = $(this)[0].value;
const idx = filename.lastIndexOf("\\");
filename = filename.substr(idx + 1);

$('label[for=\'user_imageFile_file\']').html(filename);
});
});
function getStateForm(niveau) {


switch (niveau) {
case 'Apipa':
$('#user_id_region').val('');
$('#user_id_commune').val('');
$('#user_id_region').parent().parent().parent().css('display', 'none');
$('#user_id_commune').parent().parent().parent().css('display', 'none');
break;
case 'Ministeriel':
$('#user_id_region').val('');
$('#user_id_commune').val('');
$('#user_id_region').parent().parent().parent().css('display', 'none');
$('#user_id_commune').parent().parent().parent().css('display', 'none');
break;
case 'Regionale':
$('#user_id_region').parent().parent().parent().css('display', 'flex');
$('#user_id_commune').parent().parent().parent().css('display', 'none');
break;
case 'SRAT':
$('#user_commune').val('');
$('#user_id_region').parent().parent().parent().css('display', 'flex');
$('#user_id_commune').parent().parent().parent().css('display', 'none');
break;
case 'Communale':
$('#user_id_region').parent().parent().parent().css('display', 'flex');
$('#user_id_commune').parent().parent().parent().css('display', 'flex');
break;
default:
$('#user_id_region').parent().parent().parent().css('display', 'none');
$('#user_id_commune').parent().parent().parent().css('display', 'none');
}

$("#loader").show();
$.ajax({
url: '/register/from-ajax-privilege',
type: 'post',
data: {
niveau: niveau
},
success: function (response) { // Replace current position field ...

$("#user_privileges").empty();

var lastKey = Object.keys(response)[Object.keys(response).length - 1];

// $("#user_commune").append('<option value="">Choisir Commune</option>');

$.each(response, function (key, privilege) { // alert(privilege);
$("#user_privileges").append('<option value="' + key + '">' + privilege + '</option>').trigger('change');

});
$("#loader").hide();
// Position field now displays the appropriate positions.
}
});
}

function getCommunes(idRegion) {
$.ajax({
url: '/register/from-ajax',
type: 'post',
data: {
idRegion: idRegion
},
success: function (html) { // Replace current position field ...
$('.agileits-top').replaceWith(
// ... with the returned one from the AJAX response.
// alert (elt);
html
);
// Position field now displays the appropriate positions.
}
});
}

function getCommunes2(idRegion) {
if ($('#user_niveau').val() == 'Communale') {
$("#loader").show();
$.ajax({
url: '/register/from-ajax2',
type: 'post',
data: {
idRegion: idRegion
},
success: function (response) { // Replace current position field ...
$("#user_id_commune").empty();

var lastKey = Object.keys(response)[Object.keys(response).length - 1];

$("#user_id_commune").append('<option value="">Choisir Commune</option>');

$.each(response, function (key, commune) {
$("#user_id_commune").append('<option value="' + commune['gid'] + '">' + commune['nom_commun'] + '</option>').trigger('change');

});
$("#loader").hide();
// Position field now displays the appropriate positions.
}
});
}
}
	</script>
{% endblock %}

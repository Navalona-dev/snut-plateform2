{% extends 'base.html.twig' %}

{% block title %}Superviseur central - région RMANut{% endblock %}

{% block body %}
    <div class="container-supervisor">
        <div class="centerContentDiv">
            <button type="button" class="btn btn-success" onclick="window.location='{{ path('app_accueil') }}'">Retour</button>
        </div>
        <div class="row"> 
            <h5>Tableau de Bord</h5> 
            <div class="col-lg-12">
                <table class="table table-bordered">
                    <tr>
                        <td class="titleTblRightBold"><h4>Consultation Région</h4></td>
                        <td><h4 class="text-warning">{{ dataRegion.Nom }}</h4></td>
                        <td class="titleTblRightBold">Nom</td>
                        <td>{{ dataUser.nomUser }}</td>
                        <td class="titleTblRightBold">Prénoms</td>
                        <td>{{ dataUser.prenomsUser }}</td>
                        <td class="titleTblRightBold">Email</td>
                        <td>{{ dataUser.emailUser }}</td>
                        <td class="titleTblRightBold">Téléphone</td>
                        <td>{{ dataUser.telephone }}</td> 
                    </tr>  
                </table>
            </div>  
        </div>

        <!-- INFORMATION CONCERNANT RMA NUT -->
        <div class="row margin-left-right-10"> 
            <div class="col-lg-6">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <tr class="table-success">
                            <th colspan="10" class="textTblCenterBold">
                                Liste des RMA Nut envoyé par les districts
                            </th>
                        </tr>
                        <tr class="table-success">
                            <td class="textTblCenterBold">Districts</td>
                            <td class="textTblCenterBold">Responsables</td> 
                            <td class="textTblCenterBold">Date</td>
                            <td class="textTblCenterBold">Fichier</td>
                        </tr>
                        {% for district in lstRMANutRegion %}
                        <tr>
                            <td class="textTblLeft" {% if district.nomUser|trim is empty %} style="color: #c71c22" {% endif %}>
                                {{ district.districtNom }} 
                                {% if district.nomUser|trim is not empty %}
                                    <a href="{{ path('app_rmanut_extract_historic_responsable_district', {'responsableId': district.idUser}) }}"> Visualiser l'historique d'admission réel</a>
                                {% endif %}
                            </td>
                            <td class="textTblLeft">{% if district.nomUser|trim is not empty %} {{ district.nomUser }} {{ district.prenomUser }} <br/> <span style="font-size: 12px;">{{ district.telephoneUser }} <br/><b>Email: {{ district.email }} </b> </span>{% endif %}</td> 
                            <td class="textTblLeft">{% if district.nomUser|trim is not empty %} {{ district.uploadedDate|date('d-m-Y H:i:s') }} {% endif %}</td>
                            <td class="textTblLeft"><a href="{{ asset('uploads/RMANut/' ~ district.newFileName) }}" target="_blank" style="color: #73a839; font-weight: bold;"><span style="font-size: 12px;">{{ district.newFileName }}</span></a></td>
                        </tr>
                        {% endfor %} 
                    </table>
                </div> 
            </div> 
            <div class="col-lg-6" style="overflow-x: auto;">
                <canvas id="districtsChart" height="200px;"></canvas> 
            </div>
        </div>
    </div>
    <script src="{{ asset('js/Chart.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var districtsDataRmaNut = {{ districtsDataRmaNut|json_encode|raw }};
            var ctx = document.getElementById('districtsChart').getContext('2d');

            var labels = [];
            var data = [];

            districtsDataRmaNut.forEach(function(district) {
                labels.push(district.districtName);
                data.push(district.countRMANut );
            });

            var myChartRmaNut = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Districts ayant envoyé le fichier RMANut',
                        data: data,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    maintainAspectRatio: false, // Désactiver le maintien du rapport d'aspect
                    responsive: true
                }
            });
        });
    </script>
{% endblock %}